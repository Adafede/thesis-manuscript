## Results and Discussion

This section is structured as follows: 
First, an overview of the process is illustrated.
The main technical elements are then detailed.
Then, the different results of the process are illustrated and the added value of the approach is demonstrated for a case study, *Swertia chirayita* (Roxb.) H. Karst.
In addition, the consistency of the results with the literature is detailed, and some borderline cases are finally presented.

### Workflow

A scheme of the general workflow is presented in Figure @fig:cascade-1.

![**Schematic view of the presented workflow** After the LC-MS/MS-CAD acquisition, the data are subjected to several processing steps. On the CAD side, a first pre-processing step is performed to enhance the signal. Then, peaks are automatically detected and integrated. On the MS/MS side, features are detected, grouped according to Ion Identity Networking and clustered into a Molecular Network. They are then annotated at the chemical class and/or structure level. The CAD peaks and MS features are then linked together by a peak shape similarity calculation. An additional feature filtering step based on the knowledge of the sample can be performed. This provides combined qualitative and semi-quantitative information that can be explored in multiple ways.](images/cascade_workflow.pdf "cascade-1"){#fig:cascade-1 short-caption="Schematic view of the presented workflow" width="100%"}

As a minimal input, the workflow requires LC-MS/MS data, supplemented by another detector (here CAD and PDA).
Multiple processing step then follow, and will be detailed in the next subchapters.
First, signals are aligned as described in [Signals Alignment](#signals-alignment).
Being very noisy, the CAD required additional processing as described in [CAD Processing](#charged-aerosol-detector-cad-processing).
After several signal processing steps described below, a qualitative and semi-quantitative report is generated, as well as visual means to interrogate the data.
In parallel, MS features are extracted, clustered and annotated, as described in [MS/MS Processing](#tandem-mass-spectrometry-msms-processing).
Afterwards, MS features are attributed to CAD peaks as described in [Link Between CAD and MS Data](#link-between-cad-and-ms-data).
Finally, different automated numerical and visual reports are generated as described in [Illustration of the Results](#illustration-of-the-results).

### Data Processing

#### Signals Alignment

The first necessary step was to align the signals of the different detectors. 
In the configuration used, the nondestructive PDA detector was placed first, before the split.
The delay of the PDA signal was 0.055 minutes and that of the MS signal was 0.090 minutes, respectively.
These values were used to align the signals as shown in Figure @fig:cascade-2.

![**Alignment of the different signals after preprocessing of each signal.** All signals were preprocessed to improve the downstream steps. CAD and PDA signals are at the top, in red and green, respectively. MS signals (positive and negative modes) are at the bottom, in light and dark blue, respectively. A zoomed-in area showing the different intensities normalized to the observed signal is also shown.](images/cascade_example_chromatogram.pdf "cascade-2"){#fig:cascade-2 short-caption="Alignment of the different signals after preprocessing of each signal" width="100%"}

Figure @fig:cascade-2 highlights the complementarity between each signal obtained.
While the PDA intensity approximately follows the CAD intensity when a signal is present, some major molecules without a chromophore are ignored if only UV is used.
The same is true for MS ionization modes.
Although the presented approach also works with only one polarity, it is highly recommended to use both to improve coverage.

#### Charged Aerosol Detector (CAD) Processing

As CAD signal was very noisy, it required some preprocessing steps before peak extraction. 
These are briefly described hereafter and more in details in the related Materials and Methods section.
First, a Fourrier transform was performed, to keep only 1% of the components.
Fourier transform techniques to reduce noise were already demonstrated as powerful. [@doi:10.1016/j.trac.2021.116354]
This already allowed to greatly lower signal interferences.
Moreover, chromatographic resolution was improved using derivative enhancement approach as described in [@doi:10.1016/j.talanta.2018.09.048].
This resulted in a sharper signal, where peak detection could be performed with better results than on the raw signal. 
To ensure best possible alignment, this was also done on the other signals.

Peaks were then detected using simple algorithmic as CAD signal contains only one dimension, thus not allowing for much more elaborated techniques.
A comparison of the peaks detected automatically before and after signal processing is shown below.

![**Comparison of peak detection on raw and processed signal.** The results of the automated peak picking on the raw signal are shown on the top. Before processing, no peaks are detected due to the noise of the signal. The results of the peak picking on the processed signal are shown at the bottom. Almost no peaks are lost and very few with small shoulders are split.](images/cascade-3.pdf "cascade-3"){#fig:cascade-3 short-caption="Comparison of peak detection on raw and processed signal" width="100%"}

Multiple iterations were performed in order to find parameters allowing at the same time to pick small peaks not split big ones (data not shown).
The result illustrated in Figure @fig:cascade-3 appeared as the best compromise.
Very small, poorly defined peaks are not picked, while major peaks are, thus allowing for good peak-shappe comparison with MS features later on.
Even if seen as trivial for humans, automated pick peaking is still a challenging problem, as illustrated by diverse recent efforts trying to include machine learning to solve it [@doi:10.1021/acs.analchem.9b04811; @doi:10.1021/acs.analchem.1c02220].

#### Tandem Mass Spectrometry (MS/MS) Processing

##### Features Extraction 

MS features were extracted using MZmine3 v.3.1.0-beta. 
Trials were also made using Sirius 5.7.0.
The main advantage was it did not require any parameter, thus making optimal for automation.
As the peak picking algorithmic and adduct recognition was written by the authors of the tool themselves, downstream steps performed better.
Sirius performed well on positive mode, but negative mode led to inconsistencies so MZmine3 was preferred for both modes (data not shown).
Peakonly was also used, but its integration with the rest of the workflow, needing finely defined isotope patterns, also led to worsed performance.
Finally, some tests were performed using SLAW, but they did not reached the performance of Sirius and MZmine3.
Integration of MZmine3 and IIN in SLAW in the future might improve a lot its performance and speed.

The MGF was used to build an MN through the GNPS platform (see [fd78b0a89d6d40168fc43d5f13f71688](https://gnps.ucsd.edu/ProteoSAFe/status.jsp?task=fd78b0a89d6d40168fc43d5f13f71688) for positive and [033b5dcf471641c09907704696b82bb0](https://gnps.ucsd.edu/ProteoSAFe/status.jsp?task=033b5dcf471641c09907704696b82bb0) for negative).

The IIN were complemented using the MS1 adduct module of TIMA v2.5.4 [@doi:10.5281/zenodo.6907297]. 
Adducts, multimers, and fragments generated by the same molecule could be annotated as such, even without structural annotation.

##### Features Annotation 

MS features were annotated using a multi-tool approach.
They were annotated using Sirius 5.7.0 and complemented with annotations coming from the GNPS libraries, together with ISDB-LOTUS.
Such approach allows to use the strengths of each tool, while reducing weaknesses thanks to the other ones.
The combination of the annotations of all three tools were then submitted to taxonomically informed metabolite annotation.
This way, multicharged molecules, for example, could be annotated.

All details are given in M&Ms

`//TODO`{.red}

In positive mode, this led to XXX `//TODO`{.red}, of which XXX `//TODO`{.red} confident (XX,X%) annotations on 3,610 features.
In negative mode, this led to XXX `//TODO`{.red}, of which XXX `//TODO`{.red} confident (XX,X%) annotations on 2,312 features.

#### Link Between CAD and MS Data

Independently from features annotation, CAD and MS peaks shapes were compared.
As CAD peaks could contain multiple features, features with the best peak-shape corelation with the CAD peak were also the most legitimate ones to account for CAD signal.
As a first mandatory step, all points of CAD and MS peaks were inter- and extrapolated to the same frequency.
This is generally not needed as peak shapes compared come from the same detector, thus normally the same frequency of acquisition, but the one of CAD being approximately 10 times higher than the one of MS, resampling was performed.

The second step consisted in normalizing peaks' intensity together with a retention time normalization between boundaries.
The aim of this procedure was to improve peak shape similarity between the compounds ionizing poorly and the CAD trace.
Without this step, the MS features with the highest intensity would by default have a nicer peak shape, and thus be moore likely to be corelated to the CAD signal.

Only features with a similarity ≥ 0.6 were considered as corelated as a first step.
They were then refined to ≥ 0.8, with the possibility to change both thresholds independently.

If an MS feature had a corelation ≥ 0.8, its corresponding annotation was considered as a "major" compound, else, it was categorized as a "minor" compound.
This allowed to distinguish major and minor features even if they were all found below a same CAD peak.
The better the peak shapes, the better this classification gets, future applications in sub-micrometer columns are expected to greatly help in this regard.  `//TODO REF`{.red}

CAD peaks could envelop multiple or only few (non-)corelated adducts.
An example of a CAD peak containing multiple features corresponding to the same molecule together with a CAD peak of a molecule producing only few features is ilustrated in Figure @fig:cascade-4.

`//TODO`{.red}

`//TODO DEVELOP PEAK PURITY`{.red}

The different relations between these features could also help reducing the complexity of the data, and are detailed in the next subchapter.

#### Dimensionality Reduction 

`//TODO`{.red}

More details are given in Table @tbl:cascade-1 below.

Table: TODO {#tbl:cascade-1}

|                             |          Positive          |          Negative          |
|:--------------------------- | --------------------------:| --------------------------:|
| Total Features              | XXX                        | XXX                        | 
| Ion identity groups         | XXX                        | XXX                        | 
| CAD peaks                   | XXX                        | XXX                        | 
| Features per peak           | XXX                        | XXX                        | 
| Structures per peak         | XXX                        | XXX                        | 
| Molecular formulas per peak | XXX                        | XXX                        | 
| Chemical classes per peak   | XXX                        | XXX                        | 


`//TODO`{.red}

##### Metadata-Based (taxo)

When multiple candidate structures were left below a single CAD peak, an additional filter was implemented to further narrow down the major compounds.
This filter consisted in favoring compounds already known in the genus of the studied extract.
If the compound was already isolated from the same source, the probability it is a major compound are way higher. 
If a compound was found in the studied species, all other candidate "major" compounds were switched to the "minor" category, except if also found in the species.
The same rule was then applied to the genus, with precedence to the species' compounds.

A pseudo-chromatogram illustrating the biological provenance of the annotated compounds in regard to the extract biologicall source is proposed in Figure @fig:cascade-5.

Figure `//TODO`{.red}

`//TODO DEVELOP`{.red}

A challenging example of two features corresonding to structures known to the genus is illustated in SUPPL  `//TODO`{.red}.

 `//TODO TAC FIGURE`{.red}

### Illustration of the Results

Small intro `//TODO`{.red}

#### Pseudo Chromatogram

With numbers and stars `//TODO`{.red}

#### Automated Reports

Html tables `//TODO`{.red}

#### CAD-Informed Molecular Network (MN)

Show example(s)?  `//TODO`{.red}

### Literature Matching

`//TODO`{.red}

As an approximation of compounds present in the extracts, a query of reported compounds in the producing organism was performed on Wikidata, which is now the largest occurrences resource for natural products.
The returned list of compounds for each producing organism was then filtered to better match the LC-MS run conditions 

`//TODO`{.red} (see Material and Methods).

Comparison between the composition obtained by LC-MS and the one reported in the literature is illustrated below.

Show example(s)?  `//TODO`{.red}

### Edge Cases

`//TODO`{.red}

#### Elution Peak

Maybe HILIC example for discussion `//TODO`{.red}

#### Number of Apex and Clusters Below a Single CAD Peak

`//TODO`{.red}

### Other

`//TODO`{.red}

Charged aerosol detector response modeling for fatty acids based on experimental settings and molecular features: a machine learning approach [@doi:10.1186/s13321-021-00532-0]

Universal response model for a corona charged aerosol detector [@doi:10.1016/j.chroma.2010.09.056]

Universal Response in Liquid Chromatography Using Charged Aerosol Detection [@doi:10.1021/ac060078j]

DecoMS2 [@doi:10.1021/ac400751j], mspeakpurity [@doi:10.1021/acs.analchem.6b04358]

Aerosol-Based Detectors in Liquid Chromatography [@doi:10.1002/9781119390725.ch4]

Effects of eluent temperature and elution bandwidth on detection response for aerosol-based detectors [@doi:10.1016/j.chroma.2013.07.111]

Comparison of the response of four aerosol detectors used with ultra high pressure liquid chromatography [@doi:10.1016/j.chroma.2011.01.062]

Power function setting in charged aerosol detection for the linearization of detector response – optimization strategies and their application [@doi:10.1016/j.chroma.2020.461844]

Revealing the inner workings of the power function algorithm in Charged Aerosol Detection: A simple and effective approach to optimizing power function value for quantitative analysis [@doi:10.1016/j.chroma.2019.04.017]


Chose which one as good compromise `//TODO`{.red}

Calculated peak capacity (400g/mol, 40°C) (HPLC Calculator version 3.1): [@doi:10.1016/j.ejpb.2007.06.018]

050x2.1x1.7, 07 min 600uL: **199**

050x2.1x1.7, 07 min 900uL: **204**

050x2.1x1.7, 21 min 600uL: **251**

100x2.1x1.7, 21 min 500uL: **307**

150x2.1x1.7, 42 min 400uL: **393**

150x2.1x1.7, 126 min 400uL: **480**

Show increasing peak purity `//TODO`{.red}
